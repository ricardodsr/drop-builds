import{l as y,j as e,x as A,p as g,y as C,q as w,A as j,z as D,C as l,e as a,b as d,c as o,m as p,D as i}from"./index-QpcEAcYr.js";import{u as S}from"./useQuery-DWEKjWdE.js";import{L as U}from"./LoadingSpinner-De5HNu0Z.js";import{T as P}from"./trending-up-46vWibqc.js";import{D as R}from"./database-B-rHWynS.js";const H=()=>{var u;const{role:N,isSuperuser:m,loading:x}=y(),{data:t,isLoading:b}=S({queryKey:["admin-dashboard-stats"],queryFn:async()=>{const[{count:s},{count:r},{data:v},{data:n}]=await Promise.all([i.from("profiles").select("*",{count:"exact",head:!0}),i.from("prompt_history").select("*",{count:"exact",head:!0}),i.from("audit_log").select("*").order("created_at",{ascending:!1}).limit(5),i.from("user_roles").select("role")]);return{totalUsers:s||0,totalPrompts:r||0,recentActivity:v||[],roleDistribution:(n==null?void 0:n.reduce((c,h)=>(c[h.role]=(c[h.role]||0)+1,c),{}))||{}}},enabled:!x&&m});if(x||b)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(U,{})});if(!m)return e.jsxs(A,{children:[e.jsx(g,{className:"h-4 w-4"}),e.jsxs(C,{children:["Access denied. You need superuser privileges to access the admin dashboard.",e.jsx("br",{}),"Current role: ",N||"unknown"]})]});const f=[{title:"Total Users",value:(t==null?void 0:t.totalUsers)||0,icon:w,color:"text-blue-600",bgColor:"bg-blue-100"},{title:"Prompts Generated",value:(t==null?void 0:t.totalPrompts)||0,icon:j,color:"text-green-600",bgColor:"bg-green-100"},{title:"System Health",value:"98.5%",icon:P,color:"text-purple-600",bgColor:"bg-purple-100"},{title:"Active Issues",value:"0",icon:D,color:"text-red-600",bgColor:"bg-red-100"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:f.map(s=>{const r=s.icon;return e.jsx(l,{className:"hover:shadow-md transition-shadow",children:e.jsx(a,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:s.title}),e.jsx("p",{className:"text-2xl font-bold",children:s.value})]}),e.jsx("div",{className:`p-3 rounded-full ${s.bgColor}`,children:e.jsx(r,{className:`w-6 h-6 ${s.color}`})})]})})},s.title)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5"}),"Recent Activity"]})}),e.jsx(a,{children:e.jsx("div",{className:"space-y-4",children:(u=t==null?void 0:t.recentActivity)!=null&&u.length?t.recentActivity.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-b-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.action}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleString()})]}),e.jsx(p,{variant:"outline",className:"text-xs",children:s.resource})]},r)):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No recent activity"})})})]}),e.jsxs(l,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5"}),"Role Distribution"]})}),e.jsx(a,{children:e.jsx("div",{className:"space-y-3",children:Object.entries((t==null?void 0:t.roleDistribution)||{}).map(([s,r])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(p,{variant:s==="superuser"?"destructive":s==="moderator"?"secondary":"outline",children:s})}),e.jsx("span",{className:"text-sm font-medium",children:r})]},s))})})]})]}),e.jsxs(l,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"System Status"]})}),e.jsx(a,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-green-600 font-semibold text-lg",children:"Operational"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Database"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-green-600 font-semibold text-lg",children:"Healthy"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"API Services"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-green-600 font-semibold text-lg",children:"Normal"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Response Time"})]})]})})]})]})};export{H as AdminDashboard};
